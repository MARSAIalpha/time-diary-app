<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
   <!-- PWA å¿…å¤‡ -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#764ba2">
<script>
  // æ³¨å†Œ Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½å‘¨è®° - æ—¶å…‰æ—¥è®°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .article-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            transform: translateY(-2px);
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .hero-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
            backdrop-filter: blur(10px);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .api-key-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }
        
        .api-key-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transition: all 0.3s ease;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .article-content {
            font-size: 1.1rem;
            color: #374151;
            line-height: 1.8;
        }
        
        .article-content h2 {
            color: #1f2937;
            font-weight: 700;
            margin: 2rem 0 1.5rem 0;
            font-size: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        
        .article-content h3 {
            color: #374151;
            font-weight: 600;
            margin: 1.5rem 0 1rem 0;
            font-size: 1.25rem;
        }
        
        .article-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
            text-indent: 2em;
        }
        
        .article-content h2 + p {
            text-indent: 0;
            font-size: 1.15rem;
            color: #4b5563;
            font-style: italic;
            margin-bottom: 2rem;
        }
        
        .article-content ul {
            margin: 1.5rem 0;
            padding-left: 2rem;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 0.5rem;
            padding: 1rem 1.5rem 1rem 3rem;
        }
        
        .article-content li {
            margin-bottom: 0.75rem;
            color: #4b5563;
            position: relative;
        }
        
        .article-content li::before {
            content: 'â€¢';
            color: #3b82f6;
            font-weight: bold;
            position: absolute;
            left: -1rem;
        }
        
        .article-content h3 + p {
            text-indent: 0;
            margin-bottom: 1rem;
        }
        
        .mobile-menu {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .mobile-menu a {
            color: #374151 !important;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 0.5rem;
            margin: 0.25rem 0;
        }
        
        .mobile-menu a:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6 !important;
            transform: translateX(4px);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.6);
        }
        
        @media (max-width: 768px) {
            .article-container {
                margin: 1rem;
                padding: 1.5rem;
            }
            
            .floating-action-btn {
                bottom: 1rem;
                right: 1rem;
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg border-b border-white border-opacity-20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">æ—¶</span>
                    </div>
                    <span class="text-white font-bold text-xl">æ—¶å…‰æ—¥è®°</span>
                </div>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="nav-link text-white font-medium">æ—¶é—´è½´</a>
                    <a href="calendar.html" class="nav-link text-white font-medium">æ—¥å†</a>
                    <a href="editor.html" class="nav-link text-white font-medium">å†™æ—¥è®°</a>
                    <a href="summary.html" class="nav-link text-white font-medium">AIå‘¨è®°</a>
                </div>
                
                <div class="md:hidden relative">
                    <button class="text-white p-2" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- ç§»åŠ¨ç«¯èœå• -->
            <div id="mobile-menu" class="md:hidden hidden mobile-menu border-t border-white border-opacity-20 absolute top-full left-0 right-0 z-40">
                <div class="px-4 py-3">
                    <div class="grid grid-cols-2 gap-2">
                        <a href="index.html" class="block px-4 py-3 text-center font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200">
                            <div class="text-lg mb-1">ğŸ“š</div>
                            <div class="text-sm">æ—¶é—´è½´</div>
                        </a>
                        <a href="calendar.html" class="block px-4 py-3 text-center font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200">
                            <div class="text-lg mb-1">ğŸ“…</div>
                            <div class="text-sm">æ—¥å†</div>
                        </a>
                        <a href="editor.html" class="block px-4 py-3 text-center font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200">
                            <div class="text-lg mb-1">âœï¸</div>
                            <div class="text-sm">å†™æ—¥è®°</div>
                        </a>
                        <a href="summary.html" class="block px-4 py-3 text-center font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200">
                            <div class="text-lg mb-1">ğŸ¤–</div>
                            <div class="text-sm">AIå‘¨è®°</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- HeroåŒºåŸŸ -->
    <section class="hero-section py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">AIæ™ºèƒ½å‘¨è®°</h1>
            <p class="text-xl text-white text-opacity-90 mb-8">è®©AIå¸®ä½ æ€»ç»“æœ¬å‘¨æ—¶å…‰ï¼Œç”Ÿæˆä¸“å±å‘¨è®°</p>
            
            <!-- æ—¶é—´ç­›é€‰ -->
            <div class="inline-flex items-center space-x-4 bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-xl p-4">
                <span class="text-white font-medium">æ—¶é—´èŒƒå›´ï¼š</span>
                <button class="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium" id="current-week">æœ¬å‘¨</button>
                <button class="px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors" id="last-week">ä¸Šå‘¨</button>
            </div>
        </div>
    </section>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="py-8">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- ç”ŸæˆæŒ‰é’® -->
            <div class="text-center mb-8">
                <button id="generate-summary-btn" onclick="generateAIWeeklySummary()" 
                        class="generate-btn px-8 py-3 text-white rounded-lg font-medium text-lg">
                    <span id="generate-btn-text">ğŸ¤– ç”ŸæˆAIå‘¨è®°</span>
                    <div id="generate-loading" class="loading-spinner hidden mx-auto"></div>
                </button>
                <p class="text-sm text-gray-600 mt-2">ç‚¹å‡»æŒ‰é’®ï¼ŒKimi AIå°†ä¸ºæ‚¨ç”Ÿæˆä¸€ç¯‡å®Œæ•´çš„å‘¨è®°æ–‡ç« </p>
            </div>

            <!-- AIç”Ÿæˆçš„å‘¨è®°æ–‡ç«  -->
            <div id="weekly-article" class="article-container rounded-xl p-8 hidden">
                <div class="text-center mb-6">
                    <h2 id="article-title" class="text-3xl font-bold text-gray-800 mb-4">æœ¬å‘¨æ—¶å…‰å‘¨è®°</h2>
                    <div class="flex items-center justify-center space-x-4 text-sm text-gray-600">
                        <span id="article-date"></span>
                        <span>â€¢</span>
                        <span>AIæ™ºèƒ½ç”Ÿæˆ</span>
                    </div>
                </div>
                
                <div id="article-content" class="article-content">
                    <!-- AIç”Ÿæˆçš„æ–‡ç« å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                    <p class="text-sm text-gray-500">
                        ğŸ’¡ è¿™ç¯‡æ–‡ç« ç”±AIæ ¹æ®æ‚¨çš„æ—¥è®°å†…å®¹æ™ºèƒ½ç”Ÿæˆï¼Œå¦‚æœ‰ä¸å‡†ç¡®ä¹‹å¤„ï¼Œè¯·è°…è§£
                    </p>
                    <div class="mt-4 space-x-4">
                        <button onclick="copyArticle()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            å¤åˆ¶æ–‡ç« 
                        </button>
                        <button onclick="regenerateArticle()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            é‡æ–°ç”Ÿæˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ— æ•°æ®æç¤º -->
            <div id="no-data-message" class="article-container rounded-xl p-8 text-center hidden">
                <div class="text-gray-400 mb-4">
                    <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-600 mb-2">æš‚æ— æ—¥è®°è®°å½•</h3>
                <p class="text-gray-500 mb-4">æœ¬å‘¨è¿˜æ²¡æœ‰è¶³å¤Ÿçš„æ—¥è®°è®°å½•æ¥ç”ŸæˆAIå‘¨è®°</p>
                <a href="editor.html" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors inline-block">
                    å»å†™æ—¥è®°
                </a>
            </div>
        </div>
    </main>

    <!-- API Keyè®¾ç½®åŒºåŸŸ - ç§»åˆ°é¡µé¢åº•éƒ¨ -->
    <section class="py-6" id="api-key-section">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="article-container rounded-xl p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Kimi API è®¾ç½®</h3>
                        <p class="text-sm text-gray-600">è¯·è®¾ç½®æ‚¨çš„Kimi API Keyä»¥ä½¿ç”¨AIæ™ºèƒ½æ€»ç»“åŠŸèƒ½</p>
                    </div>
                    <button onclick="toggleApiKeyInput()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        è®¾ç½®API Key
                    </button>
                </div>
                
                <div id="api-key-input-container" class="hidden mt-4">
                    <div class="flex gap-3">
                        <input type="password" id="api-key-input" placeholder="è¯·è¾“å…¥æ‚¨çš„Kimi API Key" 
                               class="api-key-input flex-1 px-4 py-2 rounded-lg text-sm">
                        <button onclick="saveApiKey()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            ä¿å­˜
                        </button>
                        <button onclick="testApiKey()" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                            æµ‹è¯•
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">
                        ğŸ’¡ æç¤ºï¼šAPI Keyå°†ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œè¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨å®‰å…¨
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="py-8">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- ç”ŸæˆæŒ‰é’® -->
            <div class="text-center mb-8">
                <button id="generate-summary-btn" onclick="generateAIWeeklySummary()" 
                        class="generate-btn px-8 py-3 text-white rounded-lg font-medium text-lg">
                    <span id="generate-btn-text">ğŸ¤– ç”ŸæˆAIå‘¨è®°</span>
                    <div id="generate-loading" class="loading-spinner hidden mx-auto"></div>
                </button>
                <p class="text-sm text-gray-600 mt-2">ç‚¹å‡»æŒ‰é’®ï¼ŒKimi AIå°†ä¸ºæ‚¨ç”Ÿæˆä¸€ç¯‡å®Œæ•´çš„å‘¨è®°æ–‡ç« </p>
            </div>

            <!-- AIç”Ÿæˆçš„å‘¨è®°æ–‡ç«  -->
            <div id="weekly-article" class="article-container rounded-xl p-8 hidden">
                <div class="text-center mb-6">
                    <h2 id="article-title" class="text-3xl font-bold text-gray-800 mb-4">æœ¬å‘¨æ—¶å…‰å‘¨è®°</h2>
                    <div class="flex items-center justify-center space-x-4 text-sm text-gray-600">
                        <span id="article-date"></span>
                        <span>â€¢</span>
                        <span>AIæ™ºèƒ½ç”Ÿæˆ</span>
                    </div>
                </div>
                
                <div id="article-content" class="article-content">
                    <!-- AIç”Ÿæˆçš„æ–‡ç« å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                    <p class="text-sm text-gray-500">
                        ğŸ’¡ è¿™ç¯‡æ–‡ç« ç”±AIæ ¹æ®æ‚¨çš„æ—¥è®°å†…å®¹æ™ºèƒ½ç”Ÿæˆï¼Œå¦‚æœ‰ä¸å‡†ç¡®ä¹‹å¤„ï¼Œè¯·è°…è§£
                    </p>
                    <div class="mt-4 space-x-4">
                        <button onclick="copyArticle()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            å¤åˆ¶æ–‡ç« 
                        </button>
                        <button onclick="regenerateArticle()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            é‡æ–°ç”Ÿæˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ— æ•°æ®æç¤º -->
            <div id="no-data-message" class="article-container rounded-xl p-8 text-center hidden">
                <div class="text-gray-400 mb-4">
                    <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-600 mb-2">æš‚æ— æ—¥è®°è®°å½•</h3>
                <p class="text-gray-500 mb-4">æœ¬å‘¨è¿˜æ²¡æœ‰è¶³å¤Ÿçš„æ—¥è®°è®°å½•æ¥ç”ŸæˆAIå‘¨è®°</p>
                <a href="editor.html" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors inline-block">
                    å»å†™æ—¥è®°
                </a>
            </div>
        </div>
    </main>

    <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
    <button class="floating-action-btn" onclick="window.location.href='editor.html'" title="å†™æ—¥è®°">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
    </button>

    <!-- é¡µè„š -->
    <footer class="bg-black bg-opacity-20 backdrop-filter backdrop-blur-lg border-t border-white border-opacity-20 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-white text-opacity-75">Â© 2025 æ—¶å…‰æ—¥è®°. è®°å½•ç”Ÿæ´»ï¼Œçè—ç¾å¥½.</p>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        let currentPeriod = 'current-week';
        
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadApiKey();
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            anime({
                targets: '.article-container',
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 800,
                delay: 200,
                easing: 'easeOutQuart'
            });
        });
        
        function setupEventListeners() {
            // æ—¶é—´ç­›é€‰æŒ‰é’®
            document.getElementById('current-week').addEventListener('click', function() {
                setActivePeriod('current-week');
                currentPeriod = 'current-week';
                hideArticle();
            });
            
            document.getElementById('last-week').addEventListener('click', function() {
                setActivePeriod('last-week');
                currentPeriod = 'last-week';
                hideArticle();
            });
        }
        
        function setActivePeriod(period) {
            const currentBtn = document.getElementById('current-week');
            const lastBtn = document.getElementById('last-week');
            
            if (period === 'current-week') {
                currentBtn.classList.add('bg-blue-500', 'text-white');
                currentBtn.classList.remove('text-white', 'hover:bg-white', 'hover:bg-opacity-20');
                lastBtn.classList.remove('bg-blue-500', 'text-white');
                lastBtn.classList.add('text-white', 'hover:bg-white', 'hover:bg-opacity-20');
            } else {
                lastBtn.classList.add('bg-blue-500', 'text-white');
                lastBtn.classList.remove('text-white', 'hover:bg-white', 'hover:bg-opacity-20');
                currentBtn.classList.remove('bg-blue-500', 'text-white');
                currentBtn.classList.add('text-white', 'hover:bg-white', 'hover:bg-opacity-20');
            }
        }
        
        function toggleApiKeyInput() {
            const container = document.getElementById('api-key-input-container');
            container.classList.toggle('hidden');
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            if (apiKey) {
                localStorage.setItem('kimi_api_key', apiKey);
                showNotification('API Key ä¿å­˜æˆåŠŸï¼');
                document.getElementById('api-key-input-container').classList.add('hidden');
            } else {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„API Key', 'error');
            }
        }
        
        function loadApiKey() {
            // é»˜è®¤API Key
            const defaultApiKey = 'sk-eW...8Iqvb';
            const savedKey = localStorage.getItem('kimi_api_key');
            
            if (savedKey) {
                document.getElementById('api-key-input').value = savedKey;
            } else {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„keyï¼Œä½¿ç”¨é»˜è®¤key
                document.getElementById('api-key-input').value = defaultApiKey;
                localStorage.setItem('kimi_api_key', defaultApiKey);
                // éšè—APIè®¾ç½®åŒºåŸŸï¼Œå› ä¸ºå·²ç»æœ‰é»˜è®¤keyäº†
                document.getElementById('api-key-section').style.display = 'none';
            }
        }
        
        async function testApiKey() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            if (!apiKey) {
                showNotification('è¯·å…ˆè¾“å…¥API Key', 'error');
                return;
            }
            
            showNotification('æ­£åœ¨æµ‹è¯•APIè¿æ¥...', 'info');
            
            try {
                const response = await fetch('https://api.moonshot.cn/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    showNotification('API Key æœ‰æ•ˆï¼è¿æ¥æˆåŠŸ', 'success');
                } else if (response.status === 401) {
                    showNotification('API Key æ— æ•ˆï¼Œè¯·æ£€æŸ¥å¯†é’¥', 'error');
                } else {
                    showNotification(`APIæµ‹è¯•å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                showNotification('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'error');
            }
        }
        
        async function generateAIWeeklySummary() {
            if (!timeDiary || !timeDiary.diaryData) {
                showNoDataMessage();
                return;
            }
            
            const diaries = getDiariesForPeriod(currentPeriod);
            
            if (diaries.length === 0) {
                showNoDataMessage();
                return;
            }
            
            const apiKey = localStorage.getItem('kimi_api_key');
            if (!apiKey) {
                showNotification('è¯·å…ˆè®¾ç½®Kimi API Key', 'error');
                document.getElementById('api-key-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            showGeneratingState();
            
            try {
                const article = await generateArticleWithAI(diaries, apiKey);
                displayArticle(article);
            } catch (error) {
                console.error('ç”ŸæˆAIå‘¨è®°å¤±è´¥:', error);
                showNotification('ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥API Keyæˆ–ç½‘ç»œè¿æ¥', 'error');
                hideGeneratingState();
            }
        }
        
        function getDiariesForPeriod(period) {
            const now = new Date();
            let startDate;
            
            if (period === 'last-week') {
                const lastWeek = new Date(now);
                lastWeek.setDate(now.getDate() - now.getDay() - 7);
                startDate = new Date(lastWeek);
                startDate.setHours(0, 0, 0, 0);
            } else {
                startDate = new Date(now);
                startDate.setDate(now.getDate() - now.getDay());
                startDate.setHours(0, 0, 0, 0);
            }
            
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            endDate.setHours(23, 59, 59, 999);
            
            return timeDiary.diaryData.filter(diary => {
                const diaryDate = new Date(diary.date);
                return diaryDate >= startDate && diaryDate <= endDate;
            });
        }
        
        async function generateArticleWithAI(diaries, apiKey) {
            // ä½¿ç”¨çœŸå®çš„Kimi APIç”Ÿæˆæ–‡ç« 
            const prompt = `è¯·æ ¹æ®ä»¥ä¸‹æ—¥è®°å†…å®¹ç”Ÿæˆä¸€ç¯‡ä¸ªäººå‘¨è®°ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š

ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•…äº‹æ€§å™è¿°ï¼ˆçº¦600-800å­—ï¼‰
è¯·ä»¥å°è¯´çš„ç¬”è§¦ï¼Œç”¨ç¬¬ä¸€äººç§°å™è¿°æœ¬å‘¨çš„ç»å†ã€‚å¼€å¤´è¦æœ‰å¼•äººå…¥èƒœçš„å¥å­ï¼Œæè¿°ä¸€å‘¨çš„æ•´ä½“æ°›å›´å’Œä¸»è¦æ•…äº‹çº¿ã€‚é€šè¿‡å…·ä½“çš„åœºæ™¯ã€å¯¹è¯å’Œå†…å¿ƒç‹¬ç™½ï¼Œå°†æ¯å¤©çš„æ—¥è®°å†…å®¹ä¸²è”æˆä¸€ä¸ªè¿è´¯çš„æ•…äº‹ã€‚æ³¨é‡æƒ…æ„Ÿè¡¨è¾¾å’Œç»†èŠ‚æå†™ï¼Œè®©è¯»è€…èƒ½å¤Ÿæ„Ÿå—åˆ°ä½œè€…çš„å–œæ€’å“€ä¹ã€‚

ç¬¬äºŒéƒ¨åˆ†ï¼šè¡ŒåŠ¨æ€§æ€»ç»“ï¼ˆçº¦300-400å­—ï¼‰
è¯·ä»¥æ¸…å•å’Œè¡ŒåŠ¨æŒ‡å—çš„å½¢å¼ï¼Œæ€»ç»“æœ¬å‘¨çš„æ”¶è·å’Œä¸‹å‘¨çš„è®¡åˆ’ã€‚
- æœ¬å‘¨å®Œæˆçš„é‡è¦äº‹é¡¹
- å­¦åˆ°çš„ç»éªŒå’Œæ•™è®­  
- ä¸‹å‘¨çš„å…·ä½“è¡ŒåŠ¨è®¡åˆ’
- éœ€è¦æ”¹è¿›çš„åœ°æ–¹
- ç»™è‡ªå·±çš„å»ºè®®å’Œé¼“åŠ±

æ—¥è®°å†…å®¹ï¼š
${diaries.map(d => `ã€${d.date} ${d.time}ã€‘${d.title}\n${d.content}`).join('\n\n')}

è¦æ±‚ï¼š
1. ç¬¬ä¸€éƒ¨åˆ†è¦æœ‰æ•…äº‹æ€§ï¼Œåƒå°è¯´ä¸€æ ·å¼•äººå…¥èƒœ
2. ç¬¬äºŒéƒ¨åˆ†è¦æœ‰å®ç”¨æ€§ï¼Œåƒè¡ŒåŠ¨æŒ‡å—ä¸€æ ·å…·ä½“
3. æ•´ä½“è¯­æ°”æ¸©æš–ç§¯æï¼Œå……æ»¡æ­£èƒ½é‡
4. ä½¿ç”¨Markdownæ ¼å¼ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨##å¼€å¤´ï¼Œç¬¬äºŒéƒ¨åˆ†ç”¨###å¼€å¤´`;

            try {
                const response = await fetch('https://api.moonshot.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'moonshot-v1-8k',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                const articleContent = data.choices[0].message.content;
                
                return formatAIResponse(articleContent, diaries);
                
            } catch (error) {
                console.error('Kimi APIè°ƒç”¨å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿç”Ÿæˆ
                return generateMockArticle(diaries);
            }
        }

            try {
                const response = await fetch('https://api.moonshot.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'moonshot-v1-8k',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                const articleContent = data.choices[0].message.content;
                
                return formatAIResponse(articleContent, diaries);
                
            } catch (error) {
                console.error('Kimi APIè°ƒç”¨å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿç”Ÿæˆ
                return generateMockArticle(diaries);
            }
        }
        
        function formatAIResponse(content, diaries) {
            const weekStart = new Date(diaries[diaries.length - 1].date);
            const weekEnd = new Date(diaries[0].date);
            
            const formatDate = (date) => {
                return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            };
            
            const title = `æ—¶å…‰å‘¨è®°ï¼š${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
            
            // å°†AIè¿”å›çš„æ–‡æœ¬æ ¼å¼åŒ–ä¸ºHTML
            let formattedContent = content
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^(.*)$/gm, '<p>$1</p>');
            
            // æ·»åŠ æ ‡é¢˜æ ¼å¼
            formattedContent = formattedContent
                .replace(/<p># (.*?)<\/p>/g, '<h3>$1</h3>')
                .replace(/<p>## (.*?)<\/p>/g, '<h4>$1</h4>');
            
            return {
                title,
                content: formattedContent,
                date: `${formatDate(weekStart)} - ${formatDate(weekEnd)}`
            };
        }
        
        function generateMockArticle(diaries) {
            const weekStart = new Date(diaries[diaries.length - 1].date);
            const weekEnd = new Date(diaries[0].date);
            
            const formatDate = (date) => {
                return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            };
            
            // åˆ†ææ—¥è®°å†…å®¹
            const activities = analyzeDiariesContent(diaries);
            const feelings = analyzeFeelings(diaries);
            const achievements = analyzeAchievements(diaries);
            
            const title = `æ—¶å…‰å‘¨è®°ï¼š${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
            
            // ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•…äº‹æ€§å™è¿°
            let content = `<h2>æœ¬å‘¨çš„æ•…äº‹</h2>`;
            content += `<p>æ—¶å…‰æ‚„ç„¶æµè½¬ï¼Œè¿™ä¸€å‘¨çš„ç”Ÿæ´»å¦‚åŒä¸€æœ¬ç¼“ç¼“å±•å¼€çš„ä¹¦å·ï¼Œæ¯ä¸€é¡µéƒ½è®°å½•ç€æˆ‘ä¸è¿™ä¸ªä¸–ç•Œçš„æ¸©æŸ”å¯¹è¯ã€‚</p>`;
            
            if (activities.length > 0) {
                content += `<p>ä»${formatDate(weekStart)}å¼€å§‹ï¼Œæˆ‘çš„ç”Ÿæ´»å°±å……æ»¡äº†å„ç§è‰²å½©ã€‚è¿™ä¸€å‘¨ï¼Œæˆ‘${activities.slice(0, 2).join('ã€')}ï¼Œæ¯ä¸€ä¸ªç¬é—´éƒ½å€¼å¾—çè—ã€‚</p>`;
            }
            
            if (feelings.length > 0) {
                content += `<p>å¿ƒæƒ…å°±åƒå¤©æ°”ä¸€æ ·å˜åŒ–å¤šç«¯ï¼Œæ—¶è€Œ${feelings.slice(0, 2).join('ï¼Œæ—¶è€Œ')}ã€‚è¿™äº›æ„Ÿå—è®©æˆ‘æ›´åŠ äº†è§£äº†è‡ªå·±ï¼Œä¹Ÿè®©æˆ‘å­¦ä¼šäº†å¦‚ä½•ä¸æƒ…ç»ªå’Œè°ç›¸å¤„ã€‚</p>`;
            }
            
            content += `<p>æ¯å¤©æ™šä¸Šï¼Œå½“æˆ‘ååœ¨ä¹¦æ¡Œå‰å›é¡¾ä¸€å¤©çš„ç»å†æ—¶ï¼Œé‚£äº›çœ‹ä¼¼å¹³å‡¡çš„ç¬é—´éƒ½å˜å¾—é—ªé—ªå‘å…‰ã€‚ä¹Ÿè®¸è¿™å°±æ˜¯è®°å½•çš„æ„ä¹‰â€”â€”è®©å¹³å‡¡çš„æ—¥å­å˜å¾—ä¸å†å¹³å‡¡ã€‚</p>`;
            
            // ç¬¬äºŒéƒ¨åˆ†ï¼šè¡ŒåŠ¨æ€§æ€»ç»“
            content += `<h2>è¡ŒåŠ¨æŒ‡å—</h2>`;
            
            if (achievements.length > 0) {
                content += `<h3>æœ¬å‘¨æˆå°±</h3>`;
                content += `<p>è¿™ä¸€å‘¨æˆ‘å–å¾—äº†ä¸€äº›è¿›æ­¥ï¼š${achievements.join('ã€')}ã€‚æ¯ä¸€ä¸ªå°å°çš„æˆå°±éƒ½æ˜¯å‰è¿›çš„åŠ¨åŠ›ï¼Œè®©æˆ‘æ›´åŠ åšä¿¡åšæŒçš„åŠ›é‡ã€‚</p>`;
            }
            
            content += `<h3>ä¸‹å‘¨è®¡åˆ’</h3>`;
            content += `<p>å±•æœ›æœªæ¥ä¸€å‘¨ï¼Œæˆ‘ç»™è‡ªå·±åˆ¶å®šäº†ä»¥ä¸‹è¡ŒåŠ¨è®¡åˆ’ï¼š</p>`;
            content += `<ul>`;
            content += `<li>ç»§ç»­ä¿æŒè®°å½•çš„ä¹ æƒ¯ï¼Œç”¨æ–‡å­—è®°å½•æ›´å¤šç¾å¥½ç¬é—´</li>`;
            content += `<li>å°è¯•æ–°çš„äº‹ç‰©ï¼Œè®©ç”Ÿæ´»æ›´åŠ ä¸°å¯Œå¤šå½©</li>`;
            content += `<li>ä¿æŒç§¯æå¿ƒæ€ï¼Œç”¨å¾®ç¬‘é¢å¯¹æ¯ä¸€å¤©</li>`;
            content += `<li>ç»™è‡ªå·±ä¸€äº›ç‹¬å¤„çš„æ—¶é—´ï¼Œè†å¬å†…å¿ƒçš„å£°éŸ³</li>`;
            content += `</ul>`;
            
            content += `<p>ç”Ÿæ´»å› è®°å½•è€Œç²¾å½©ï¼Œæ—¶å…‰å› æ–‡å­—è€Œæ°¸æ’ã€‚æ„Ÿè°¢è¿™ä¸€å‘¨çš„æ‰€æœ‰ç»å†ï¼Œè®©æˆ‘æˆé•¿ï¼Œè®©æˆ‘æ„Ÿæ‚Ÿã€‚æœŸå¾…ä¸‹ä¸€å‘¨ä¼šæœ‰æ›´å¤šç²¾å½©çš„æ•…äº‹ç­‰ç€æˆ‘å»å‘ç°ï¼</p>`;
            
            return {
                title,
                content,
                date: `${formatDate(weekStart)} - ${formatDate(weekEnd)}`
            };
        }
        
        function analyzeDiariesContent(diaries) {
            const activities = [];
            const keywords = {
                'è¯»ä¹¦å­¦ä¹ ': ['ä¹¦', 'é˜…è¯»', 'å­¦ä¹ ', 'è¯¾ç¨‹'],
                'è¿åŠ¨å¥èº«': ['è¿åŠ¨', 'è·‘æ­¥', 'å¥èº«', 'é”»ç‚¼'],
                'å·¥ä½œé¡¹ç›®': ['å·¥ä½œ', 'é¡¹ç›®', 'ä»»åŠ¡', 'ä¼šè®®'],
                'ä¼‘é—²å¨±ä¹': ['ç”µå½±', 'éŸ³ä¹', 'æ¸¸æˆ', 'æ”¾æ¾'],
                'æ—…è¡Œå¤–å‡º': ['æ—…è¡Œ', 'å¤–å‡º', 'æ•£æ­¥', 'æ¸¸ç©'],
                'ç¤¾äº¤èšä¼š': ['æœ‹å‹', 'èšä¼š', 'èŠå¤©', 'è§é¢']
            };
            
            diaries.forEach(diary => {
                Object.entries(keywords).forEach(([activity, words]) => {
                    if (words.some(word => diary.content.includes(word)) && !activities.includes(activity)) {
                        activities.push(activity);
                    }
                });
            });
            
            return activities;
        }
        
        function analyzeFeelings(diaries) {
            const feelings = [];
            const keywords = {
                'å¼€å¿ƒ': ['å¼€å¿ƒ', 'å¿«ä¹', 'é«˜å…´', 'æ„‰å¿«'],
                'æ»¡è¶³': ['æ»¡è¶³', 'å……å®', 'å¹¸ç¦', 'æ»¡æ„'],
                'ç–²æƒ«': ['ç´¯', 'ç–²æƒ«', 'ç–²å€¦', 'ç–²åŠ³'],
                'ç„¦è™‘': ['ç„¦è™‘', 'æ‹…å¿ƒ', 'ç´§å¼ ', 'å‹åŠ›'],
                'å¹³é™': ['å¹³é™', 'å®‰é™', 'èˆ’é€‚', 'æƒ¬æ„']
            };
            
            diaries.forEach(diary => {
                Object.entries(keywords).forEach(([feeling, words]) => {
                    if (words.some(word => diary.content.includes(word)) && !feelings.includes(feeling)) {
                        feelings.push(feeling);
                    }
                });
            });
            
            return feelings;
        }
        
        function analyzeAchievements(diaries) {
            const achievements = [];
            const keywords = {
                'å®Œæˆç›®æ ‡': ['å®Œæˆ', 'è¾¾æˆ', 'å®ç°', 'æˆåŠŸ'],
                'å­¦ä¹ è¿›æ­¥': ['å­¦ä¼š', 'æŒæ¡', 'è¿›æ­¥', 'æé«˜'],
                'è§£å†³é—®é¢˜': ['è§£å†³', 'å…‹æœ', 'æˆ˜èƒœ', 'å¤„ç†'],
                'è·å¾—æˆé•¿': ['æˆé•¿', 'æ”¶è·', 'ç»éªŒ', 'é¢†æ‚Ÿ']
            };
            
            diaries.forEach(diary => {
                Object.entries(keywords).forEach(([achievement, words]) => {
                    if (words.some(word => diary.content.includes(word)) && !achievements.includes(achievement)) {
                        achievements.push(achievement);
                    }
                });
            });
            
            return achievements;
        }
        
        function displayArticle(article) {
            document.getElementById('article-title').textContent = article.title;
            document.getElementById('article-date').textContent = article.date;
            document.getElementById('article-content').innerHTML = article.content;
            
            document.getElementById('weekly-article').classList.remove('hidden');
            hideGeneratingState();
            
            // æ»šåŠ¨åˆ°æ–‡ç« ä½ç½®
            document.getElementById('weekly-article').scrollIntoView({ behavior: 'smooth' });
        }
        
        function showGeneratingState() {
            document.getElementById('generate-btn-text').classList.add('hidden');
            document.getElementById('generate-loading').classList.remove('hidden');
            document.getElementById('generate-summary-btn').disabled = true;
        }
        
        function hideGeneratingState() {
            document.getElementById('generate-btn-text').classList.remove('hidden');
            document.getElementById('generate-loading').classList.add('hidden');
            document.getElementById('generate-summary-btn').disabled = false;
        }
        
        function hideArticle() {
            document.getElementById('weekly-article').classList.add('hidden');
        }
        
        function showNoDataMessage() {
            document.getElementById('no-data-message').classList.remove('hidden');
            document.getElementById('weekly-article').classList.add('hidden');
        }
        
        function hideNoDataMessage
